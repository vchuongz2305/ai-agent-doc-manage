{
  "name": "Bui Cong Chuong - check GDPR",
  "nodes": [
    {
      "parameters": {
        "content": "### LU·ªíNG 2: AI DOCUMENT MANAGEMENT AGENT ‚Äì GDPR COMPLIANCE (Fixed Clean)\n\n**M·ª•c ƒë√≠ch:** T·ª± ƒë·ªông ki·ªÉm tra tu√¢n th·ªß GDPR cho t√†i li·ªáu.\n\n**T√≠nh nƒÉng ch√≠nh:**\n‚Ä¢ AI quy·∫øt ƒë·ªãnh h√†nh ƒë·ªông GDPR (delete/anonymize/allow)\n‚Ä¢ X√°c ƒë·ªãnh legal basis, DSR, retention\n‚Ä¢ T·ª± ƒë·ªông th√¥ng b√°o DPO khi c·∫ßn\n‚Ä¢ Ghi log v√† audit trail ƒë·∫ßy ƒë·ªß.\n\n**C·∫£i ti·∫øn:**\n‚Ä¢ S·ª≠a l·ªói ph√¢n nh√°nh If/Else chu·∫©n.\n‚Ä¢ Th√™m Merge node ƒë·ªÉ h·ª£p nh·∫•t c√°c nh√°nh h√†nh ƒë·ªông."
      },
      "name": "üìã M√¥ t·∫£ Lu·ªìng GDPR",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1760,
        -448
      ],
      "id": "44b8796f-bd9f-45bb-8029-a1ac5d0b892b"
    },
    {
      "parameters": {
        "jsCode": "// Chu·∫©n h√≥a d·ªØ li·ªáu ƒë·∫ßu v√†o cho ki·ªÉm tra GDPR\nconst input = $json ?? {};\nconst body = input.body ?? {};\n\n// üîç Th·ª≠ l·∫•y email c·ªßa ch·ªß s·ªü h·ªØu t·ª´ output Google Drive Trigger\nlet ownerEmail = null;\ntry {\n  ownerEmail =\n    input.owners?.[0]?.emailAddress ||\n    body.owners?.[0]?.emailAddress ||\n    input.lastModifyingUser?.emailAddress ||\n    null;\n} catch (e) {\n  ownerEmail = null;\n}\n\n// üîó T·∫°o URL file t·ª´ Google Drive th√¥ng tin\nlet fileUrl = null;\nlet fileId = null;\nlet fileName = null;\nlet fileSize = null;\nlet mimeType = null;\n\ntry {\n  // L·∫•y th√¥ng tin file t·ª´ Google Drive Trigger\n  fileId = input.id || body.id || null;\n  fileName = input.name || body.name || null;\n  fileSize = input.size || body.size || null;\n  mimeType = input.mimeType || body.mimeType || null;\n  \n  // T·∫°o URL Google Drive\n  if (fileId) {\n    fileUrl = `https://drive.google.com/file/d/${fileId}/view`;\n  }\n} catch (e) {\n  console.warn('‚ö†Ô∏è L·ªói khi x·ª≠ l√Ω th√¥ng tin Google Drive:', e.message);\n}\n\n// üß± D·ªØ li·ªáu m·∫´u (fallback khi thi·∫øu input)\nconst defaultData = {\n  documentTitle: fileName || 'T√†i li·ªáu m·∫´u - GDPR Check',\n  documentCategory: 'Nh√¢n s·ª±',\n  documentSummary: 'T√†i li·ªáu ch·ª©a d·ªØ li·ªáu c√° nh√¢n c·∫ßn ki·ªÉm tra GDPR',\n  originalFileId: fileId || 'sample_file_gdpr',\n  fileSize: fileSize || '1.0MB',\n  uploadDate: new Date().toISOString(),\n  uploader: ownerEmail || 'privacy@company.com', // ‚úÖ d√πng email owner n·∫øu c√≥\n  hasPersonalInfo: true,\n  containsSpecialCategoryData: false,\n  dataSubjectRequest: null,\n  legalBasis: null\n};\n\n// üß† G·ªôp d·ªØ li·ªáu: ∆Øu ti√™n input ‚Üí body ‚Üí m·∫∑c ƒë·ªãnh\nconst merged = {\n  documentTitle: input.documentTitle || body.documentTitle || defaultData.documentTitle,\n  documentCategory: input.documentCategory || body.documentCategory || defaultData.documentCategory,\n  documentSummary: input.documentSummary || body.documentSummary || defaultData.documentSummary,\n  originalFileId: input.originalFileId || body.originalFileId || defaultData.originalFileId,\n  fileSize: input.fileSize || body.fileSize || defaultData.fileSize,\n  uploadDate: input.uploadDate || body.uploadDate || defaultData.uploadDate,\n  uploader: input.uploader || body.uploader || defaultData.uploader, // üëà d√πng uploader ƒë·ªông\n  hasPersonalInfo: input.hasPersonalInfo ?? body.hasPersonalInfo ?? defaultData.hasPersonalInfo,\n  containsSpecialCategoryData: input.containsSpecialCategoryData ?? body.containsSpecialCategoryData ?? defaultData.containsSpecialCategoryData,\n  dataSubjectRequest: input.dataSubjectRequest ?? body.dataSubjectRequest ?? defaultData.dataSubjectRequest,\n  legalBasis: input.legalBasis ?? body.legalBasis ?? defaultData.legalBasis\n};\n\n// üßæ Th√™m metadata h·ªá th·ªëng v√† th√¥ng tin file\nconst result = {\n  receivedAt: new Date().toISOString(),\n  workflowSource: 'gdpr-compliance',\n  processingTimestamp: new Date().toISOString(),\n  // üîó Th√¥ng tin file t·ª´ Google Drive\n  fileUrl: fileUrl,\n  fileId: fileId,\n  fileName: fileName,\n  mimeType: mimeType,\n  // üìä Th√¥ng tin Google Drive g·ªëc\n  googleDriveInfo: {\n    id: fileId,\n    name: fileName,\n    size: fileSize,\n    mimeType: mimeType,\n    url: fileUrl,\n    owners: input.owners || body.owners || null,\n    lastModifyingUser: input.lastModifyingUser || body.lastModifyingUser || null\n  },\n  ...merged\n};\n\n// üßπ D·ªçn undefined/null\nfor (const key in result) {\n  if (result[key] === undefined) result[key] = null;\n  if (typeof result[key] === 'string') result[key] = result[key].trim();\n}\n\n// ‚úÖ Tr·∫£ ra JSON ho√†n ch·ªânh\nreturn [{ json: result }];\n"
      },
      "name": "2Ô∏è‚É£ Chu·∫©n h√≥a d·ªØ li·ªáu ƒë·∫ßu v√†o",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1360,
        -96
      ],
      "id": "89959532-8edf-49f1-9f14-fbd6764a3dda"
    },
    {
      "parameters": {
        "resource": "document",
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "text": "=Ph√¢n t√≠ch GDPR. Quy·∫øt ƒë·ªãnh: delete|anonymize|allow.\n\n{\n  \"content\": {\n    \"gdprDecision\": \"delete|anonymize|allow\",\n    \"notifyDPO\": true,\n    \"legalBasis\": \"consent|contract|null\",\n    \"retentionDays\": 30,\n    \"redactionFields\": [],\n    \"gdprJustification\": \"L√Ω do\",\n    \"fileUrl\": \"{{ $json.fileUrl }}\",\n    \"fileName\": \"{{ $json.fileName }}\",\n    \"personalDataFound\": [],\n    \"sensitiveDataDetected\": false,\n    \"dataVolume\": \"high|medium|low\"\n  },\n  \"finishReason\": \"stop\",\n  \"index\": 0,\n  \"uploader\": {{ $json.uploader }}\n}",
        "options": {}
      },
      "name": "3Ô∏è‚É£ AI GDPR Decision",
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -1152,
        -96
      ],
      "id": "3b5d4957-2fdb-4e3c-95a1-98864c580347",
      "credentials": {
        "googlePalmApi": {
          "id": "91898OzbZbpGF2b2",
          "name": "Google Gemini(PaLM) Api account 4"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// üß† Parse k·∫øt qu·∫£ AI GDPR (Node 4) - FIXED VERSION\nlet ai = {};\nlet raw = '';\nlet clean = '';\nlet match = null;\n\ntry {\n  // üîç L·∫•y text t·ª´ ph·∫£n h·ªìi c·ªßa Gemini\n  raw = $json?.content?.parts?.[0]?.text || $json?.text || JSON.stringify($json);\n\n  // üßπ L√†m s·∫°ch k√Ω hi·ªáu code block\n  clean = raw.replace(/```json/gi, '').replace(/```/g, '').trim();\n\n  // üîé T√¨m ƒëo·∫°n JSON trong text\n  match = clean.match(/\\{[\\s\\S]*\\}/);\n\n  // üßæ Parse JSON\n  ai = JSON.parse(match ? match[0] : clean);\n  console.log(\"‚úÖ Parsed AI JSON:\", ai);\n} catch (error) {\n  console.warn(\"‚ö†Ô∏è Parse error:\", error.message);\n  console.log(\"üìù Raw preview:\", raw?.slice(0, 300));\n\n  // üõü Fallback an to√†n\n  ai = {\n    content: {\n      gdprDecision: \"anonymize\",\n      notifyDPO: true,\n      gdprJustification: \"‚ö†Ô∏è Parsing fallback due to invalid AI output\"\n    },\n    uploader: \"dangnguyen0175@gmail.com\"\n  };\n}\n\n// üß© H·ª£p nh·∫•t d·ªØ li·ªáu ƒë·∫ßu v√†o + k·∫øt qu·∫£ AI\nconst result = {\n  ...$input.first().json,\n  aiRawOutput: raw || null,\n\n  // üß† L·∫•y d·ªØ li·ªáu t·ª´ c·∫•u tr√∫c l·ªìng nhau (ai.content.*)\n  gdprDecision: ai.content?.gdprDecision || ai.gdprDecision || ai.action || \"anonymize\",\n  notifyDPO: !!(ai.content?.notifyDPO ?? ai.notifyDPO),\n  gdprJustification: ai.content?.gdprJustification || ai.gdprJustification || ai.justification || \"N/A\",\n  legalBasis: ai.content?.legalBasis || ai.legalBasis || null,\n  dataSubjectRequest: ai.content?.dataSubjectRequest || ai.dataSubjectRequest || null,\n  retentionDays: ai.content?.retentionDays || ai.retentionDays || 30,\n  redactionFields: ai.content?.redactionFields || ai.redactionFields || [],\n  aiDecisionTimestamp: ai.aiDecisionTimestamp || new Date().toISOString(),\n  uploader: ai.uploader || $input.first().json.uploader || \"dangnguyen0175@gmail.com\",\n  // üîó Th√¥ng tin file t·ª´ AI (n·∫øu c√≥)\n  fileUrl: ai.content?.fileUrl || $input.first().json.fileUrl || null,\n  fileName: ai.content?.fileName || $input.first().json.fileName || null,\n  // üîç Th√¥ng tin ph√¢n t√≠ch n·ªôi dung file\n  personalDataFound: ai.content?.personalDataFound || ai.personalDataFound || [],\n  sensitiveDataDetected: ai.content?.sensitiveDataDetected ?? ai.sensitiveDataDetected ?? false,\n  dataVolume: ai.content?.dataVolume || ai.dataVolume || 'unknown',\n  // üßæ Log th√™m th√¥ng tin tr·∫°ng th√°i parser\n  aiParseStatus: match ? \"success\" : \"fallback\",\n  aiParsed: ai\n};\n\n// üßæ Log k·∫øt qu·∫£ cu·ªëi c√πng ƒë·ªÉ ki·ªÉm tra\nconsole.log(\"üìú GDPR Parsed Result:\", result);\n\nreturn [{ json: result }];\n"
      },
      "name": "4Ô∏è‚É£ Parse quy·∫øt ƒë·ªãnh GDPR",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -960,
        -96
      ],
      "id": "e349f3ff-5cdb-42c3-b7ea-3008883cf033"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "condition1",
              "leftValue": "={{ $json.gdprDecision }}",
              "rightValue": "delete",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "name": "5Ô∏è‚É£ H√†nh ƒë·ªông: Delete ?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -768,
        -224
      ],
      "id": "16570a87-fbdb-4d81-962c-2451736c9e79"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "condition1",
              "leftValue": "={{ $json.gdprDecision }}",
              "rightValue": "anonymize",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "name": "6Ô∏è‚É£ H√†nh ƒë·ªông: Anonymize ?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -768,
        -64
      ],
      "id": "6946f8f6-9367-4c47-9273-486a57d54b73"
    },
    {
      "parameters": {
        "jsCode": "// ===============================================\n// üßπ GDPR ACTION: DELETE / REVOKE DOCUMENT ACCESS\n// ===============================================\n\n// L·∫•y d·ªØ li·ªáu ƒë·∫ßu v√†o\nconst data = $json;\nconst fileId = data.originalFileId || null;\n\n// Bi·∫øn k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh\nlet result = {\n  ...data,\n  gdprActionPerformed: 'delete',\n  status: 'GDPR_REVOKE_APPLIED',\n  deleteSuccess: false,\n  deleteMethod: null,\n  deleteTimestamp: new Date().toISOString(),\n  deleteLog: ''\n};\n\n// N·∫øu c√≥ ID file g·ªëc th√¨ ti·∫øn h√†nh ‚Äúx√≥a‚Äù (ho·∫∑c thu h·ªìi chia s·∫ª)\ntry {\n  if (fileId) {\n    // --- N·∫øu b·∫°n d√πng Google Drive API ---\n    // Gi·∫£ l·∫≠p h√†nh ƒë·ªông g·ªçi API n8n kh√°c (·ªü m√¥i tr∆∞·ªùng th·ª±c, s·∫Ω d√πng node Google Drive Delete)\n    result.deleteMethod = 'revoke_access';\n    result.deleteSuccess = true;\n    result.deleteLog = `T√†i li·ªáu ${fileId} ƒë√£ ƒë∆∞·ª£c thu h·ªìi quy·ªÅn truy c·∫≠p.`;\n  } else {\n    result.deleteLog = 'Kh√¥ng t√¨m th·∫•y originalFileId ƒë·ªÉ x√≥a.';\n  }\n} catch (err) {\n  result.status = 'GDPR_DELETE_FAILED';\n  result.deleteSuccess = false;\n  result.deleteLog = `L·ªói khi x√≥a: ${err.message}`;\n}\n\n// Tr·∫£ v·ªÅ k·∫øt qu·∫£ x·ª≠ l√Ω\nreturn [{ json: result }];\n"
      },
      "name": "7Ô∏è‚É£ Th·ª±c thi Delete/Revoke",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -576,
        -304
      ],
      "id": "28124028-d9fc-48bd-9b15-3e823153e526"
    },
    {
      "parameters": {
        "jsCode": "// Gi·∫£ l·∫≠p ·∫©n danh/redact\nlet summary = $json.documentSummary || '';\nfor (const f of ($json.redactionFields || [])) summary = summary.replace(new RegExp(f, 'gi'), '[REDACTED]');\nreturn { json: { ...$json, documentSummary: summary, gdprActionPerformed: 'anonymize', status: 'GDPR_ANON_APPLIED' } };"
      },
      "name": "7Ô∏è‚É£ Th·ª±c thi Anonymize/Redact",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -576,
        -64
      ],
      "id": "cc8da31e-6341-4aad-9983-0b582482166a"
    },
    {
      "parameters": {
        "jsCode": "return { json: { ...$json, gdprActionPerformed: 'allow', status: 'GDPR_ALLOWED' } };"
      },
      "name": "7Ô∏è‚É£.5Ô∏è‚É£ ƒê·∫∑t tr·∫°ng th√°i Allow",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -576,
        128
      ],
      "id": "d9cdd524-7505-4c82-8852-6fe138479bab"
    },
    {
      "parameters": {},
      "name": "7.8 Merge Actions",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 1,
      "position": [
        -400,
        -288
      ],
      "id": "a9fdb4c3-b871-453d-950b-04c003ebafda"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "condition1",
              "leftValue": "={{ $json.notifyDPO }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equal"
              }
            },
            {
              "id": "f37a3bfe-bcfc-4d92-b65b-c672411cf81e",
              "leftValue": "={{ $json.notifyDPO }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "name": "8Ô∏è‚É£ C·∫ßn th√¥ng b√°o DPO ?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -208,
        -96
      ],
      "id": "e4b64e9b-b6cd-43da-8d4d-2e57c374134f"
    },
    {
      "parameters": {
        "sendTo": "tranhaduy204@gmail.com",
        "subject": "=üîê GDPR Alert: {{ $json.gdprDecision?.toUpperCase() || 'UNKNOWN' }} file requires immediate attention",
        "emailType": "text",
        "message": "=K√≠nh ch√†o DPO,\n\nH·ªá th·ªëng AI GDPR Compliance Agent ƒë√£ ph√°t hi·ªán m·ªôt t√†i li·ªáu vi ph·∫°m quy ƒë·ªãnh GDPR v√† c·∫ßn s·ª± can thi·ªáp ngay l·∫≠p t·ª©c.\n\n**Th√¥ng tin t√†i li·ªáu:**\n- T√™n file: {{ $json.fileName || 'Kh√¥ng x√°c ƒë·ªãnh' }}\n- URL file: {{ $json.fileUrl || 'Kh√¥ng c√≥ URL' }}\n- Uploader: {{ $json.uploader || 'Kh√¥ng x√°c ƒë·ªãnh' }}\n- Quy·∫øt ƒë·ªãnh x·ª≠ l√Ω: {{ $json.gdprDecision || 'Kh√¥ng x√°c ƒë·ªãnh' }}\n- Th√¥ng b√°o DPO: {{ $json.notifyDPO || 'Kh√¥ng' }}\n- C∆° s·ªü ph√°p l√Ω: {{ $json.legalBasis || 'Kh√¥ng c√≥' }}\n\n**üîç Ph√¢n t√≠ch n·ªôi dung file:**\n- D·ªØ li·ªáu c√° nh√¢n t√¨m th·∫•y: {{ $json.personalDataFound && $json.personalDataFound.length > 0 ? $json.personalDataFound.join(', ') : 'Kh√¥ng c√≥' }}\n- D·ªØ li·ªáu nh·∫°y c·∫£m: {{ $json.sensitiveDataDetected ? 'C√≥' : 'Kh√¥ng' }}\n- Kh·ªëi l∆∞·ª£ng d·ªØ li·ªáu: {{ $json.dataVolume || 'Kh√¥ng x√°c ƒë·ªãnh' }}\n- C√°c tr∆∞·ªùng c·∫ßn redact: {{ $json.redactionFields && $json.redactionFields.length > 0 ? $json.redactionFields.join(', ') : 'Kh√¥ng c√≥' }}\n\n**L√Ω do quy·∫øt ƒë·ªãnh:**\n{{ $json.gdprJustification || 'Kh√¥ng c√≥ l√Ω do c·ª• th·ªÉ ƒë∆∞·ª£c cung c·∫•p.' }}\n\n**Th·ªùi ƒëi·ªÉm ra quy·∫øt ƒë·ªãnh:** {{ $json.aiDecisionTimestamp || (new Date()).toISOString() }}\n\n**H√†nh ƒë·ªông khuy·∫øn ngh·ªã:**\n- Xem x√©t v√† x√°c nh·∫≠n quy·∫øt ƒë·ªãnh c·ªßa AI\n- Li√™n h·ªá v·ªõi uploader ƒë·ªÉ l√†m r√µ m·ª•c ƒë√≠ch s·ª≠ d·ª•ng d·ªØ li·ªáu\n- Th·ª±c hi·ªán c√°c bi·ªán ph√°p kh·∫Øc ph·ª•c c·∫ßn thi·∫øt\n- C·∫≠p nh·∫≠t ch√≠nh s√°ch b·∫£o m·∫≠t n·∫øu c·∫ßn\n\nTr√¢n tr·ªçng,\n**AI GDPR Compliance Agent**",
        "options": {}
      },
      "name": "9Ô∏è‚É£ G·ª≠i email DPO",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2,
      "position": [
        -16,
        -192
      ],
      "id": "ee01bb5c-0a72-4e66-8acc-83b4f8916d1e",
      "webhookId": "02bbf782-9357-4ea4-b78e-664aaad97422",
      "credentials": {
        "gmailOAuth2": {
          "id": "LTZtTwz14XXGyrdz",
          "name": "Gmail account 2"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "={{ $json.uploader || 'dangnguyen0175@gmail.com' }}",
        "subject": "=üì£ GDPR Result: {{ $json.gdprDecision?.toUpperCase() || 'UNKNOWN' }}",
        "emailType": "text",
        "message": "=K√≠nh ch√†o b·∫°n,\n\nH·ªá th·ªëng AI GDPR Compliance Agent ƒë√£ ho√†n t·∫•t vi·ªác ki·ªÉm tra tu√¢n th·ªß GDPR cho t√†i li·ªáu c·ªßa b·∫°n.\n\n**Th√¥ng tin t√†i li·ªáu:**\n- T√™n file: {{ $json.fileName || 'Kh√¥ng x√°c ƒë·ªãnh' }}\n- URL file: {{ $json.fileUrl || 'Kh√¥ng c√≥ URL' }}\n\n**üîç K·∫øt qu·∫£ ph√¢n t√≠ch n·ªôi dung:**\n- D·ªØ li·ªáu c√° nh√¢n t√¨m th·∫•y: {{ $json.personalDataFound && $json.personalDataFound.length > 0 ? $json.personalDataFound.join(', ') : 'Kh√¥ng c√≥' }}\n- D·ªØ li·ªáu nh·∫°y c·∫£m: {{ $json.sensitiveDataDetected ? 'C√≥' : 'Kh√¥ng' }}\n- Kh·ªëi l∆∞·ª£ng d·ªØ li·ªáu: {{ $json.dataVolume || 'Kh√¥ng x√°c ƒë·ªãnh' }}\n\n**K·∫øt qu·∫£ quy·∫øt ƒë·ªãnh:**\n- Quy·∫øt ƒë·ªãnh x·ª≠ l√Ω: {{ $json.gdprDecision || 'Kh√¥ng x√°c ƒë·ªãnh' }}\n- Th√¥ng b√°o DPO: {{ $json.notifyDPO || 'Kh√¥ng' }}\n- C∆° s·ªü ph√°p l√Ω: {{ $json.legalBasis || 'Kh√¥ng c√≥' }}\n- C√°c tr∆∞·ªùng c·∫ßn redact: {{ $json.redactionFields && $json.redactionFields.length > 0 ? $json.redactionFields.join(', ') : 'Kh√¥ng c√≥' }}\n\n**L√Ω do quy·∫øt ƒë·ªãnh:**\n{{ $json.gdprJustification || 'Kh√¥ng c√≥ l√Ω do ƒë∆∞·ª£c cung c·∫•p.' }}\n\n**Th·ªùi ƒëi·ªÉm ra quy·∫øt ƒë·ªãnh:** {{ $json.aiDecisionTimestamp || (new Date()).toISOString() }}\n\nN·∫øu b·∫°n c√≥ b·∫•t k·ª≥ th·∫Øc m·∫Øc n√†o v·ªÅ k·∫øt qu·∫£ n√†y, vui l√≤ng li√™n h·ªá v·ªõi b·ªô ph·∫≠n b·∫£o m·∫≠t d·ªØ li·ªáu (DPO) ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£.\n\nTr√¢n tr·ªçng,\n**AI GDPR Compliance Agent**",
        "options": {}
      },
      "name": "1Ô∏è‚É£0Ô∏è‚É£ Th√¥ng b√°o k·∫øt qu·∫£ cho uploader",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2,
      "position": [
        176,
        -96
      ],
      "id": "b24105fd-5a3e-4876-8840-a008514fb57c",
      "webhookId": "62b2fab2-9f29-4f76-9c77-89e5acbbdf61",
      "credentials": {
        "gmailOAuth2": {
          "id": "LTZtTwz14XXGyrdz",
          "name": "Gmail account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "16eU4No0bLeMYCxjo0586358kzjuBrrf52fRo_n7SDFg",
          "mode": "list",
          "cachedResultName": "Log GDPR",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16eU4No0bLeMYCxjo0586358kzjuBrrf52fRo_n7SDFg/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Trang t√≠nh1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16eU4No0bLeMYCxjo0586358kzjuBrrf52fRo_n7SDFg/edit#gid=0"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "threadId",
              "displayName": "threadId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "labelIds",
              "displayName": "labelIds",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "name": "1Ô∏è‚É£1Ô∏è‚É£ Ghi log GDPR v√†o Sheets",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [
        368,
        -96
      ],
      "id": "3163359c-2a13-4298-9ed5-f35350b121d6",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "cmWSNW94QNgr3T8o",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Audit Trail GDPR\nreturn { json: { auditId: `gdpr_${Date.now()}`, timestamp: new Date().toISOString(), ...$json } };"
      },
      "name": "1Ô∏è‚É£2Ô∏è‚É£ T·∫°o Audit Trail GDPR",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        560,
        -96
      ],
      "id": "aac785df-4161-45aa-a842-0a3facdbedd9"
    },
    {
      "parameters": {
        "jsCode": "// üîç DEBUG: Ki·ªÉm tra d·ªØ li·ªáu tr∆∞·ªõc khi g·ª≠i email\nconsole.log('üîç DEBUG - D·ªØ li·ªáu tr∆∞·ªõc email:');\nconsole.log('gdprDecision:', $json.gdprDecision);\nconsole.log('notifyDPO:', $json.notifyDPO);\nconsole.log('uploader:', $json.uploader);\nconsole.log('Full data:', JSON.stringify($json, null, 2));\n\n// üßπ ƒê·∫£m b·∫£o c√≥ d·ªØ li·ªáu c·∫ßn thi·∫øt\nconst result = {\n  ...$json,\n  // ƒê·∫£m b·∫£o c√≥ gdprDecision\n  gdprDecision: $json.gdprDecision || 'UNKNOWN',\n  // ƒê·∫£m b·∫£o c√≥ notifyDPO\n  notifyDPO: $json.notifyDPO || false,\n  // ƒê·∫£m b·∫£o c√≥ uploader\n  uploader: $json.uploader || 'dangnguyen0175@gmail.com',\n  // ƒê·∫£m b·∫£o c√≥ justification\n  gdprJustification: $json.gdprJustification || 'Kh√¥ng c√≥ l√Ω do ƒë∆∞·ª£c cung c·∫•p.',\n  // Th√™m timestamp\n  aiDecisionTimestamp: $json.aiDecisionTimestamp || new Date().toISOString()\n};\n\nconsole.log('‚úÖ DEBUG - D·ªØ li·ªáu sau x·ª≠ l√Ω:', result);\nreturn [{ json: result }];"
      },
      "name": "üîç DEBUG: Ki·ªÉm tra d·ªØ li·ªáu",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        32,
        112
      ],
      "id": "030633ec-0900-4e7e-b5a4-66c6dc76dc82"
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "19dKOR2bA5dHGHCtfZ416c5qVou0lcDwF",
          "mode": "list",
          "cachedResultName": "Extract PDF",
          "cachedResultUrl": "https://drive.google.com/drive/folders/19dKOR2bA5dHGHCtfZ416c5qVou0lcDwF"
        },
        "event": "fileCreated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -1584,
        -48
      ],
      "id": "152d20a2-fe8b-4759-8d55-d0ca0b232ffb",
      "name": "Google Drive Trigger1",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "atJ86VdDoYyS4tiT",
          "name": "Google Drive account 2"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "2Ô∏è‚É£ Chu·∫©n h√≥a d·ªØ li·ªáu ƒë·∫ßu v√†o": {
      "main": [
        [
          {
            "node": "3Ô∏è‚É£ AI GDPR Decision",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "3Ô∏è‚É£ AI GDPR Decision": {
      "main": [
        [
          {
            "node": "4Ô∏è‚É£ Parse quy·∫øt ƒë·ªãnh GDPR",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "4Ô∏è‚É£ Parse quy·∫øt ƒë·ªãnh GDPR": {
      "main": [
        [
          {
            "node": "5Ô∏è‚É£ H√†nh ƒë·ªông: Delete?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "5Ô∏è‚É£ H√†nh ƒë·ªông: Delete?": {
      "main": [
        [
          {
            "node": "7Ô∏è‚É£ Th·ª±c thi Delete/Revoke",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "6Ô∏è‚É£ H√†nh ƒë·ªông: Anonymize?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "6Ô∏è‚É£ H√†nh ƒë·ªông: Anonymize?": {
      "main": [
        [
          {
            "node": "7Ô∏è‚É£ Th·ª±c thi Anonymize/Redact",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "7Ô∏è‚É£.5Ô∏è‚É£ ƒê·∫∑t tr·∫°ng th√°i Allow",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "7Ô∏è‚É£ Th·ª±c thi Delete/Revoke": {
      "main": [
        [
          {
            "node": "7.8 Merge Actions",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "7Ô∏è‚É£ Th·ª±c thi Anonymize/Redact": {
      "main": [
        [
          {
            "node": "7.8 Merge Actions",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "7Ô∏è‚É£.5Ô∏è‚É£ ƒê·∫∑t tr·∫°ng th√°i Allow": {
      "main": [
        [
          {
            "node": "7.8 Merge Actions",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "7.8 Merge Actions": {
      "main": [
        [
          {
            "node": "8Ô∏è‚É£ C·∫ßn th√¥ng b√°o DPO?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "8Ô∏è‚É£ C·∫ßn th√¥ng b√°o DPO?": {
      "main": [
        [
          {
            "node": "9Ô∏è‚É£ G·ª≠i email DPO",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "üîç DEBUG: Ki·ªÉm tra d·ªØ li·ªáu",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "9Ô∏è‚É£ G·ª≠i email DPO": {
      "main": [
        [
          {
            "node": "üîç DEBUG: Ki·ªÉm tra d·ªØ li·ªáu",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üîç DEBUG: Ki·ªÉm tra d·ªØ li·ªáu": {
      "main": [
        [
          {
            "node": "1Ô∏è‚É£0Ô∏è‚É£ Th√¥ng b√°o k·∫øt qu·∫£ cho uploader",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "1Ô∏è‚É£0Ô∏è‚É£ Th√¥ng b√°o k·∫øt qu·∫£ cho uploader": {
      "main": [
        [
          {
            "node": "1Ô∏è‚É£1Ô∏è‚É£ Ghi log GDPR v√†o Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "1Ô∏è‚É£1Ô∏è‚É£ Ghi log GDPR v√†o Sheets": {
      "main": [
        [
          {
            "node": "1Ô∏è‚É£2Ô∏è‚É£ T·∫°o Audit Trail GDPR",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive Trigger1": {
      "main": [
        [
          {
            "node": "2Ô∏è‚É£ Chu·∫©n h√≥a d·ªØ li·ªáu ƒë·∫ßu v√†o",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "6b553c41-3c17-4fd3-ab90-ca625fadd1ce",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "d29aff038a4897a8be0d9843c07ba06d6b485556105b19c20835a7b0bfd5b9b2"
  },
  "id": "NovgqYS6R0udt74I",
  "tags": []
}